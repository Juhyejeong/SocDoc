<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="detail">

	<select id="hospitalDetail" parameterType="String" resultType="com.synergy.socdoc.member.HpInfoVO">
		select hpseq, hpname, address, phone, dept, info, mainimg, subimg1, subimg2
		from hospitalinfo
		where hpseq=#{hpseq}
	</select>
	
	<select id="hospitalRating" parameterType="String" resultType="String">
		select trunc(avg(rating)) as avg 
		from hospitalreview 
		where hpseq=#{hpseq}
	</select>
	
	<select id="getHpReviewMe" parameterType="HashMap" resultType="com.synergy.socdoc.member.HpReviewVO"> 
		select userid, content, regDate, rating 
     	from hospitalreview
     	where hpseq=#{hpSeq} and userid = #{loginuserId}
    </select>

	<select id="getHpReview" parameterType="HashMap" resultType="com.synergy.socdoc.member.HpReviewVO"> 
		select userid, content, regdate, rating 
     		from
	     	(select row_number() over (order by regDate desc) as rno,
	     		userid, content, regDate, rating 
	     	from hospitalreview
	     	where hpseq=#{hpSeq} and userid != #{loginuserId}
	     	)V
     	where V.rno between #{startRno} and #{endRno}
    </select>
	
	<select id="getReviewTotalCount" parameterType="HashMap" resultType="int">
		select count(*)
		from hospitalreview
		where hpseq = #{hpSeq}
	</select>
	
</mapper>
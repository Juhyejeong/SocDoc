<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="admin">

 	<select id="selectQnAList" resultType="com.synergy.socdoc.member.QnaBoardVO">
		select qnaSeq, subject, userid, regDate, status
		from qnaBoard
		order by qnaSeq desc 
	</select>
	
	<!-- 공지사항 상세 글보기 -->
	<select id="getView" parameterType="String" resultType="com.synergy.socdoc.member.NoticeVO">
		select  preseq, presubject, 
		        noticeseq, subject, content, regDate
		        nextseq, nextsubject
		from 
		(
		    select lag(noticeseq, 1) over(order by noticeseq desc)  as preseq
		            , lag(subject, 1) over(order by noticeseq desc) as presubject
		            , noticeseq, subject, content
		            , to_char(regDate, 'yyyy-mm-dd') as regDate
		           
		            , lead(noticeseq, 1) over(order by noticeseq desc) as nextseq
		            , lead(subject, 1) over(order by noticeseq desc) as nextsubject
		    from noticeBoard
		) V
		where V.noticeSeq = #{noticeSeq}
	</select>
 	
 	
 	<!-- 회원관리 목록 (페이징처리) -->
 	<select id="getTotalCount" parameterType="HashMap" resultType="int">
		select count(*)
		from member
		where status in (1,0)
			<if test='searchWord != ""'>
				and lower(${searchType}) like '%' || lower(#{searchWord}) || '%'
			</if>
	</select>
	<select id="memberListSearchWithPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.MemberVO">
		select rno, userid, name, birthDate, email, phone, registerDate, status
		from
	    ( 
	        select rownum as rno, userid, name, birthDate, email, phone, registerDate, status 
			from 
			(
				select userid, name, to_char(birthDate,'yyyy-mm-dd') AS birthDate, email, phone, to_char(registerDate,'yyyy-mm-dd') AS registerDate, status
				from member
				where status in (1,0)
				<if test='searchWord != ""'>
					and ${searchType} like '%' || #{searchWord} || '%'
				</if>
			) V
		)T
		where rno between #{startRno} and #{endRno}
	</select>
	

	<!-- 공지사항 글 목록 (페이징처리) -->
	<select id="noticeTotalCount" parameterType="HashMap" resultType="int">
		select count(*)
		from noticeBoard
	</select>
	<select id="noticeListPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.NoticeVO">
		select rno, noticeSeq, subject, regDate
		from
	    ( 
	        select rownum as rno, noticeSeq, subject, regDate 
			from 
			(
				select noticeSeq, subject, to_char(regDate,'yyyy-mm-dd') AS regDate
				from noticeBoard
				order by noticeSeq desc
			) V
		)T
		where rno between #{startRno} and #{endRno}
	</select>


	<!-- 건강정보 글 목록 (페이징처리) -->
	<select id="healthInfoCount" parameterType="HashMap" resultType="int">
		select count(*)
		from noticeBoard
	</select>
	<select id="healthInfoPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.HealthInfoVO">
		select rno, infoSeq, subject, regDate
		from
	    ( 
	        select rownum as rno, infoSeq, subject, regDate
			from 
			(
				select infoSeq, subject, to_char(regDate,'yyyy-mm-dd') AS regDate
				from infoBoard
				order by infoSeq desc
			) V
		)T
		where rno between #{startRno} and #{endRno}
	</select>
 	
 	
 	<select id="selectfaqList" resultType="com.synergy.socdoc.member.FaqBoardVO">
		select faqSeq, question, answer
		from faqboard
		order by faqSeq desc 
	</select>
	
	
	<!-- 병원회원 목록 (페이징처리) -->
	<select id="hpMemberCount" parameterType="HashMap" resultType="int">
		select count(*)
		from hpMember
		where infoStatus in (1,0)
			<if test='searchWord != ""'>
				and ${searchType} like '%' || #{searchWord} || '%'
			</if>
	</select>
	<select id="hpmemberListPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.HpMemberVO">
		
		select rno, userid, regId, name, email, registerDate, infoStatus
		from
	    ( 
	        select rownum as rno, userid, regId, name, email, registerDate, infoStatus
			from 
			(
				select userid, regId, name, email, to_char(registerDate,'yyyy-mm-dd') AS registerDate, infoStatus
				from hpMember
				where infoStatus in (1,0)
				<if test='searchWord != ""'>
					and ${searchType} like '%' || #{searchWord} || '%'
				</if>
			) V
		)T
		where rno between #{startRno} and #{endRno}
		
		<!-- 
		select rno, userid, regId, name, email, to_char(registerDate,'yyyy-mm-dd') AS registerDate, infoStatus, nvl(b.hpname, '미등록')
		from 
		(
			select rownum as rno, userid, regId, name, email, to_char(registerDate,'yyyy-mm-dd') AS registerDate, infoStatus, nvl(b.hpname, '미등록')
			from
				(
				select  userid, regId, name, email, to_char(registerDate,'yyyy-mm-dd') AS registerDate, infoStatus, nvl(b.hpname, '미등록')
				from hpMember A left join hospitalinfo B
				on a.hpseq = b.hpseq
				)V
			)T
		where rno between #{startRno} and #{endRno}
		
		 -->
	</select>
	
	
	<!-- 병원(정보)등록 목록 (페이징처리) -->
	<select id="hpInfoCount" parameterType="HashMap" resultType="int">
		select count(*)
		from hpMember
		where infoStatus in (1,0)
			<if test='searchWord != ""'>
				and lower(${searchType}) like '%' || lower(#{searchWord}) || '%'
			</if>
	</select>
	<select id="hpInfoListPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.HpMemberVO">
		select rno, userid, regId, name, infoStatus
		from
	    ( 
	        select rownum as rno, userid, regId, name, infoStatus
			from 
			(
				select userid, regId, name, infoStatus
				from hpMember
				where infoStatus in (1,0)
				<if test='searchWord != ""'>
					and ${searchType} like '%' || #{searchWord} || '%'
				</if>
			) V
		)T
		where rno between #{startRno} and #{endRno}
	</select>
	
	<!-- 문의관리 목록 (페이징) -->
	<select id="qnaListCount" parameterType="HashMap" resultType="int">
		select count(*)
		from qnaBoard
	</select>
	<select id="qnaListPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.QnaBoardVO">
		select rno, qnaSeq, subject, userid, regDate, status
		from
	    ( 
	        select rownum as rno, qnaSeq, subject, userid, regDate, status
			from 
			(
				select qnaSeq, subject, userid, to_char(regDate,'yyyy-mm-dd') AS regDate, status
				from qnaBoard
				order by qnaSeq desc
			) V
		)T
		where rno between #{startRno} and #{endRno}
	</select>
	
	<select id="getQnaView" parameterType="String" resultType="com.synergy.socdoc.member.QnaBoardVO">
		select subject, userid, regDate, content
		from qnaBoard
		where qnaSeq = #{qnaSeq}
	</select>
	
	
	<!-- 후기관리 목록 (페이징) -->
	<select id="reviewTotalCount" parameterType="HashMap" resultType="int">
		select count(*)
		from hospitalReview
		where hpseq is not null
			<if test='searchWord != ""'>
				and lower(${searchType}) like '%' || lower(#{searchWord}) || '%'
			</if>
	</select>
	<select id="reviewListPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.HpReviewVO">
		select rno, T.userid, T.rating, T.content, T.hpName, T.regDate
		from
		(
		select rno, V.userid, V.rating, V.content, V.hpName, V.regDate
		from
		    (select rownum as rno, R.userid, R.rating, R.content, H.hpname, to_char(R.regDate,'yyyy-mm-dd') AS regDate
		        from hospitalReview R join hospitalInfo H
		    	on R.hpseq is not null 
		    	<if test='searchWord != ""'>
		    		and ${searchType} like  '%' || #{searchWord} || '%' 
		    		and R.hpSeq = H.hpSeq
		    	</if>
		    	order by R.regDate desc
		    ) V
		order by rno
		)T
		where rno between #{startRno} and #{endRno}
	</select>
	
	
	<insert id="noticeInsert" parameterType="HashMap">
		insert into noticeBoard (noticeSeq, subject, content, regDate)
		values(noticeSeq.nextval, #{subject}, #{content}, default)
	</insert>
	
	<delete id="delNotice" parameterType="HashMap">
         delete from noticeBoard
         where noticeSeq = #{noticeSeq}
    </delete>
    
    <update id="updateNotice" parameterType="com.synergy.socdoc.member.NoticeVO">
    	update noticeBoard set subject = #{subject}, content = #{content}, regDate = sysdate
    	where noticeSeq = #{noticeSeq}
    </update>
	
</mapper>
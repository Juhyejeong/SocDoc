<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="newMem">
	<select id="getContent" resultType="String">
		select email from tbl_test where userid = 'woniyoon'
	</select>
	
	<!-- 회원가입 회원 아이디 중복검사 -->
	<select id="idChk" resultType="int">
		select count(*)
		from member
		where userid = #{userid}
	</select>
	
	<!-- 회원가입 회원 이메일 중복검사 -->
	<select id="emailChk" resultType="int">
		select count(*)
		from member
		where email = #{email}
	</select>
	
	<!-- 회원가입 병원 아이디 중복검사 -->
	<select id="hpIdChk" resultType="int">
		select count(*)
		from hpMember
		where userid = #{hpUserid}
	</select>
	
	<!-- 회원가입 병원 이메일 중복검사 -->
	<select id="hpEmailChk" resultType="int">
		select count(*)
		from hpMember
		where email = #{hpEmail}
	</select>
	
	<!-- 회원 회원가입 -->
	<insert id="register">
		insert into member(userid, email, name, phone, height, weight, bloodtype, allergy, history, medicine, memberseq, registerdate, status, birthdate, pwd)
		values(#{userid}, #{email}, #{name}, #{phone}, default, default, default, default, default, default, memberseq.nextval, sysdate, 1, default, #{pwd})
	</insert>
	
	<!-- 로그인 처리 -->
		<select id="getLoginMember" parameterType="HashMap" resultType="com.synergy.socdoc.member.MemberVO">
		select idx, userid, name, email, gradelevel
		     , trunc( months_between(sysdate, lastPwdChangeDate) ) AS pwdchangegap  
			 , trunc( months_between(sysdate, lastLoginDate) ) AS lastlogindategap <!-- lastlogindategap  memberVo의 Lastlogindategap랑 이름 같게  쨋던 VO의 값이 쏙 들어감-->
		from member
		where status = 1 and 
				userid = #{userid} and 
				pwd = #{pwd}
	</select>
	<update id="setLastLoginDate" parameterType="HashMap">
		update mymvc_shopping_member set lastLoginDate = sysdate <!-- 마지막으로 로그인 한 날짜시간/현재 시각을 기록해 주겠다. -->
		where userid = #{userid}
	</update>
	
</mapper>
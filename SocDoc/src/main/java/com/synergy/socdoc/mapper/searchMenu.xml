<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="searchMenu">

	<select id="hpMapSelect" resultType="com.synergy.socdoc.member.HpInfoVO">
		select hpseq, hpName, address, phone, latitude, longitude
		from hospitalinfo
		order by hpseq desc
	</select>
	
	
	<select id="hospitalListSearchWithPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.HpInfoVO">		
		
		select hpseq, hpname, address, phone, dept, distance
		from 
		(
		    select rownum AS rno, hpseq, hpname, address, phone, dept, distance
		    from
		    (
		        select hpseq, hpname, address, phone, dept
		        	,substr(DISTNACE_WGS84(#{latitudeHere}, #{longitudeHere}, latitude, longitude),1,instr(DISTNACE_WGS84(#{latitudeHere}, #{longitudeHere}, latitude,  longitude), '.', 1,1)+1) as DISTANCE 
		        from hospitalinfo
		        where 1 = 1
		     		and address like '%'|| #{city} ||'%'
		     		and address like '%'|| #{county} ||'%'
		     		and address like '%'|| #{district} ||'%'				
		     		and dept like '%'|| #{dept} ||'%'				
		     		and hpname like '%'|| #{searchWord} ||'%'	
		     	order by distance 			
		    ) V
		) T
		where rno between #{startRno} and #{endRno}
				
	</select>   
	
	<select id="getTotalCount" parameterType="HashMap" resultType="int">
		select count(*)
		from hospitalinfo	
		where 1=1
		<if test='searchWord != ""'>
		     and lower(${searchType}) like '%'|| lower(#{searchWord}) ||'%'
		</if>		
	</select>  
	
	
	
	<select id="mapHospitalListSearchWithPaging" parameterType="HashMap" resultType="com.synergy.socdoc.member.HpInfoVO">		
		
		select hpseq, hpname, address, phone, dept, latitude, longitude
		from 
		(
		    select rownum AS rno
		         , hpseq, hpname, address, phone, dept,latitude, longitude
		    from
		    (
		        select hpseq, hpname, address, phone, dept, latitude, longitude
		        from hospitalinfo
		        where 1 = 1
		     		and address like '%'|| #{city} ||'%'
		     		and address like '%'|| #{county} ||'%'
		     		and address like '%'|| #{district} ||'%'				
		     		and dept like '%'|| #{dept} ||'%'				
		     		and hpname like '%'|| #{searchWord} ||'%'				
		    ) V
		) T
		where rno between #{startRno} and #{endRno}
				
	</select>   
	
	<select id="getTotalCountMapHp" parameterType="HashMap" resultType="int">
		select count(*)
		from hospitalinfo	
		where 1=1
		    and address like '%'|| #{city} ||'%'
     		and address like '%'|| #{county} ||'%'
     		and address like '%'|| #{district} ||'%'				
     		and dept like '%'|| #{dept} ||'%'				
     		and hpname like '%'|| #{searchWord} ||'%'			
	</select>  
	

</mapper>
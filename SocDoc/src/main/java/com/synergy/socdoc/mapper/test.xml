<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="test">
	<select id="getContent" resultType="String">
		select email from tbl_test where userid = 'woniyoon'
	</select>
	
	<select id="selectNoticeList" resultType="com.synergy.socdoc.member.NoticeVO">
		select S.rno, S.noticeSeq, S.subject, S.regDate 
		from
		(
		select rownum as rno, V.noticeSeq, V.subject, V.regDate
		from 
		(
		select noticeSeq, subject, to_char(regDate,'yyyy-mm-dd') AS regDate 
		from noticeboard
		order by noticeSeq desc
		) V
		order by rno)S
		where 
		<![CDATA[ S.rno <= 3 ]]>
	</select>
	
	<select id="getRankList" resultType="com.synergy.socdoc.member.HpReviewVO">
		<!-- 
		select avgRating, hpName 
		from
		(
		select avg(rating) as avgRating, hpName
		from hospitalReview
		group by hpName
		order by avg(rating) desc
		)
		where 
		<![CDATA[ rownum <= 6 ]]>
		 -->
		
		select avgRating, hpName, mainImg
		from
		(
		select avg(R.rating) as avgRating, R.hpName, I.mainImg
		from hospitalReview R join hospitalinfo I
		on R.hpSeq = I.hpSeq
		group by R.hpName,I.mainImg
		order by avg(R.rating) desc
		)V
		where
		<![CDATA[ rownum <= 6 ]]>
	</select>

</mapper>